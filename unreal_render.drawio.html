<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=5,IE=9" ><![endif]-->
<!DOCTYPE html>
<html>
<head>
<title>unreal_render</title>
<meta charset="utf-8"/>
</head>
<body><div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;page&quot;:3,&quot;dark-mode&quot;:&quot;light&quot;,&quot;toolbar&quot;:&quot;pages zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;Electron\&quot; agent=\&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/26.0.9 Chrome/128.0.6613.186 Electron/32.2.5 Safari/537.36\&quot; version=\&quot;26.0.9\&quot; pages=\&quot;4\&quot;&gt;\n  &lt;diagram name=\&quot;函数调用\&quot; id=\&quot;nlAW7ank3kVb0dKWuV_G\&quot;&gt;\n    &lt;mxGraphModel dx=\&quot;2389\&quot; dy=\&quot;957\&quot; grid=\&quot;1\&quot; gridSize=\&quot;10\&quot; guides=\&quot;1\&quot; tooltips=\&quot;1\&quot; connect=\&quot;1\&quot; arrows=\&quot;1\&quot; fold=\&quot;1\&quot; page=\&quot;1\&quot; pageScale=\&quot;1\&quot; pageWidth=\&quot;827\&quot; pageHeight=\&quot;1169\&quot; math=\&quot;0\&quot; shadow=\&quot;0\&quot;&gt;\n      &lt;root&gt;\n        &lt;mxCell id=\&quot;0\&quot; /&gt;\n        &lt;mxCell id=\&quot;1\&quot; parent=\&quot;0\&quot; /&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--1\&quot; value=\&quot;FMeshBatch\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;40\&quot; y=\&quot;170\&quot; width=\&quot;200\&quot; height=\&quot;50\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxRectangle x=\&quot;40\&quot; y=\&quot;170\&quot; width=\&quot;120\&quot; height=\&quot;30\&quot; as=\&quot;alternateBounds\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--33\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--4\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--32\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--4\&quot; value=\&quot;&amp;lt;span style=&amp;quot;font-weight: normal;&amp;quot;&amp;gt;FLandscapeComponentSceneProxy::&amp;lt;/span&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;font-weight: normal;&amp;quot;&amp;gt;FLandscapeComponentSceneProxy&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=40;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;-140\&quot; y=\&quot;465\&quot; width=\&quot;240\&quot; height=\&quot;75\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--15\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--14\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--5\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--25\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--5\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--24\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--31\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--5\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--4\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--5\&quot; value=\&quot;LandscapeRender.cpp\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;570\&quot; y=\&quot;250\&quot; width=\&quot;150\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--29\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--8\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--21\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--45\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--8\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--43\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--8\&quot; value=\&quot;PrimitiveComponent.cpp\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;570\&quot; y=\&quot;500\&quot; width=\&quot;150\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--30\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--14\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--1\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;Array as=\&quot;points\&quot;&gt;\n              &lt;mxPoint x=\&quot;405\&quot; y=\&quot;210\&quot; /&gt;\n              &lt;mxPoint x=\&quot;405\&quot; y=\&quot;150\&quot; /&gt;\n              &lt;mxPoint x=\&quot;140\&quot; y=\&quot;150\&quot; /&gt;\n            &lt;/Array&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--14\&quot; value=\&quot;MeshBatch.h\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;570\&quot; y=\&quot;190\&quot; width=\&quot;150\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--19\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--16\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--27\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint x=\&quot;730\&quot; y=\&quot;430\&quot; as=\&quot;targetPoint\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--38\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--16\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--37\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--16\&quot; value=\&quot;PrimitiveComponent.cpp\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;570\&quot; y=\&quot;380\&quot; width=\&quot;150\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--23\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--21\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--22\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--50\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--21\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--49\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--21\&quot; value=\&quot;ActorComponent.cpp\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;570\&quot; y=\&quot;560\&quot; width=\&quot;150\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--55\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--22\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--54\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--22\&quot; value=\&quot;LevelTick.cpp\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;570\&quot; y=\&quot;620\&quot; width=\&quot;150\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--26\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--24\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--16\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--36\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--24\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--35\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--24\&quot; value=\&quot;Landscape.cpp\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;570\&quot; y=\&quot;320\&quot; width=\&quot;150\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--28\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--27\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--8\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--27\&quot; value=\&quot;RendererScene.cpp\&quot; style=\&quot;rounded=1;whiteSpace=wrap;html=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;570\&quot; y=\&quot;440\&quot; width=\&quot;150\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--32\&quot; value=\&quot;&amp;lt;span style=&amp;quot;font-weight: normal;&amp;quot;&amp;gt;Algo::Transform&amp;lt;/span&amp;gt;\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=25;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;-140\&quot; y=\&quot;640\&quot; width=\&quot;240\&quot; height=\&quot;60\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--40\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--27\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--41\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--35\&quot; value=\&quot;ULandscapeComponent&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;CreateSceneProxy&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=40;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;120\&quot; y=\&quot;360\&quot; width=\&quot;160\&quot; height=\&quot;60\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--37\&quot; value=\&quot;FActorPrimitiveComponentInterface::&amp;lt;div&amp;gt;CreateSceneProxy&amp;lt;/div&amp;gt;\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;284\&quot; y=\&quot;760\&quot; width=\&quot;260\&quot; height=\&quot;60\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--42\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--41\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--39\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--39\&quot; value=\&quot;FScene::&amp;lt;div&amp;gt;BatchAddPrimitivesInternal&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=40;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;180\&quot; y=\&quot;590\&quot; width=\&quot;180\&quot; height=\&quot;60\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--41\&quot; value=\&quot;&amp;lt;div&amp;gt;FScene::AddPrimitive&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=40;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;180\&quot; y=\&quot;490\&quot; width=\&quot;180\&quot; height=\&quot;60\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--43\&quot; value=\&quot;UPrimitiveComponent::&amp;lt;div&amp;gt;CreateRenderState_Concurrent&amp;lt;/div&amp;gt;\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=40;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;870\&quot; y=\&quot;445\&quot; width=\&quot;330\&quot; height=\&quot;150\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--46\&quot; value=\&quot;UPrimitiveComponent::&amp;lt;div&amp;gt;ConditionalNotifyStreamingPrimitiveUpdated_Concurrent()&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=40;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--43\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;70\&quot; width=\&quot;330\&quot; height=\&quot;80\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--47\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--43\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--43\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--46\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--53\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--49\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--52\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--49\&quot; value=\&quot;UActorComponent::&amp;lt;div&amp;gt;RecreateRenderState_Concurrent&amp;lt;/div&amp;gt;\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=40;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;740\&quot; y=\&quot;720\&quot; width=\&quot;210\&quot; height=\&quot;80\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--52\&quot; value=\&quot;UActorComponent::&amp;lt;div&amp;gt;DoDeferredRenderUpdates_Concurrent&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=40;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;725\&quot; y=\&quot;860\&quot; width=\&quot;240\&quot; height=\&quot;80\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--54\&quot; value=\&quot;UWorld::SendAllEndOfFrameUpdates\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;970\&quot; y=\&quot;700\&quot; width=\&quot;230\&quot; height=\&quot;70\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--63\&quot; value=\&quot;FMeshBatch\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;-820\&quot; y=\&quot;1180\&quot; width=\&quot;360\&quot; height=\&quot;860\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--64\&quot; value=\&quot;struct\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--63\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;360\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--65\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;变量&amp;lt;/b&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;TArray&amp;amp;lt;FMeshBatchElement, TInlineAllocator&amp;amp;lt;1&amp;amp;gt;&amp;amp;gt; Elements;&amp;lt;/span&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;FMeshBatchElement列表，构造函数往列表里加入一个默认元素。&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;const VertexFactory;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;必须，是对顶点数据的封装，用于链接顶点着色器。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;const MaterialRenderProxy;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;必须，材质代理，用于渲染。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;const LightCacheInterface;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;缓存光照的接口。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;BatchHitProxyId;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;命中代理id。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;TessellationDisablingShadowMapMeshSize;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;禁用表面细分的阈值。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;MeshIdInPrimitive;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;图元中的网络id，用于在同图元中稳定排序。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;LODIndex;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;SegmentIndex;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;uint32 xxx : 1; * 19 + PT_NumBits + SDPG_NumBits + MaterialType_NumBits&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;一系列的标志，用于确定该网络的各项渲染属性的支持性。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--63\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;360\&quot; height=\&quot;700\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--70\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;函数&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;ENGINE_API bool IsXxx(ERHIFeatureLevel::Type InFeatureLevel) const; * 5&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;一系列判断函数，通过传入的ERHIFeatureLevel Type判断网络的各种特殊属性，例如：透明，毛发等。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;FORCEINLINE int32 GetNumPrimitives() const;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;获得Elements中每个网络批中的图元的总数量。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;FORVEINLINE bool HasAnyDrawCalls() const;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;判断Elements中有没有任一元素有drawcall。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;ENGINE_API void PreparePrimitiveUniformBuffer(PrimitiveSceneProxy, FeatureLevel&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;);&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;准备图元用的统一buffer，无返回值。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;ENGINE_API bool Validate(SceneProxy, FeatureLevel);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;如果启用网络批验证，则验证，不然就返回true。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;构造函数&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;在Elements中构造并加入申明时同样的元素，并给变量赋默认值。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--63\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;500\&quot; width=\&quot;360\&quot; height=\&quot;360\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--72\&quot; value=\&quot;FMeshBatchElement\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;-420\&quot; y=\&quot;1200\&quot; width=\&quot;360\&quot; height=\&quot;1060\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--73\&quot; value=\&quot;struct\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--72\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;360\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--74\&quot; value=\&quot;&amp;lt;b&amp;gt;变量&amp;lt;/b&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;PrimitiveUniformBuffer;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;RHI图元统一缓冲区，在手动从场景中获取图元数据时必须为null。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;const PrimitiveUInivormBufferResource;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;当primitive uniform buffer为null时，作为PUB使用；这个接口让FMeshBatchElement作为同意缓冲区初始化。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;LooseParametersUniformBuffer;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;用于储存不能打包的每个网络独有的参数的统一缓冲区。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;const IndexBuffer;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;用于绘制网络批的索引缓冲区。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;DynamicIndexBuffer;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;储存动态索引，用于其三角形是动态排序的物体。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;union&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;{&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;InstanceRuns;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;const SplineMeshSceneProxy;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;如果这是样条代理，储存指向该代理；如果不是，则储存实例化运行的数量。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;const UserData;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;指向用户数据的指针。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;VertexFacturyUserData;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;含义取决于定点工厂。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;IndirectArgsBuffer;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;IndirectArgsOffset;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;指向间接参数的指针和内存偏移。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;PrimitiveIdMode；&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;由渲染器设置的图元id模式。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;FirstIndex；&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;NumPrimitives;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;图元数量，当为0时使用IndirectArgsBuffer。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;uint32/float xxIndex/size;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;实例的数量，一系列描述顶点的索引，和屏幕大小。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;uint32 xxx;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;LOD描述和一系列描述数据的标志，如：是否是带颜色的顶点，是否是样条，等等。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;VisualizeElementIndex;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;SkinCacheDebugColor;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;如果启用了ue的debug drawing，合会使用这两个设置。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;DynamicPrimitiveData;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;DynamicPrimitiveIndex;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;DynamicPrimitiveInstanceSceneDataOffset;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;使用动态图元必须的数据，源实例场景数据和负荷数据，指针指向的对象的必须有和网络批相同或更久的生命周期。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--72\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;360\&quot; height=\&quot;870\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--75\&quot; value=\&quot;&amp;lt;b&amp;gt;函数&amp;lt;/b&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;FORCEINLINE int32 GetNumPrimitives() const;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;获得图元的总数量，即每个运行实例中的图元数的总和。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;构造函数&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;给变量赋初始值。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--72\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;930\&quot; width=\&quot;360\&quot; height=\&quot;130\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--79\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.992;exitY=0.06;exitDx=0;exitDy=0;exitPerimeter=0;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--65\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--72\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--80\&quot; value=\&quot;FLandscapeComponentSceneProxy\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;397\&quot; y=\&quot;1190\&quot; width=\&quot;430\&quot; height=\&quot;1140\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--81\&quot; value=\&quot;class :&amp;amp;nbsp;FPrimitiveSceneProxy, FLandscapeSectionInfo\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--80\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;430\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--82\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--80\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;430\&quot; height=\&quot;70\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--83\&quot; value=\&quot;&amp;lt;b&amp;gt;构造函数&amp;lt;/b&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;FLandscapeComponentSceneProxy(ULandscapeComponent* InComponent);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;将InComponent传入继承的FPrimitiveSceneProxy和FLandscapeSectionInfo以传入地形相关信息。初始化变量默认值，部分通过InComponent的变量传入。(从游戏线程传到渲染线程)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;使用VisibilityHelper测试可见性。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;判断剔除规则，是用nanite，地形剔除，还是不剔除。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;获得当前gpu支持的Featurelevel。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;判断并获得材质接口，创建可用材质接口的tarray。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;如果featurelevel是OpenGLES3.1，则使用移动端材质接口，将接口加入刚创建的材质接口tarray（UE5.4移动端暂不支持动态材质实例）。不然，使用通用材质接口，如果是动态材质实例则选用动态，然后将接口加入tarray。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;获得LOD和高度贴图偏移。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;获得地形代理。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;通过地形代理获得虚拟阴影贴图的相关数据。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;通过地形代理获得LOD0的大小分布，和当前LOD的分布，如果使用了可伸缩LOD，则先获得伸缩地形质量再用其获得数据。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;如果不在发布模式下，则对从地形代理获得的相关数据进行可能的更新，若有，然后输出debug log显示landscape和component的名字。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;通过之前获得的LOD相关数据，预计算从LOD0到MAXLOD的LOD屏幕比例，并加入到LODScreenRatioSquared的tarray中。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;获得MinStreamedLOD，然后将MaxLOD和LastLOD限制到小于等于地形代理的MaxLODLevel。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;获得ForcedLOD，若不为0，则先确保其在有效范围，在将整个LOD范围都设为ForcedLOD。这将该地形的LOD限制为ForcedLOD。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;在LODSettings中更新LOD相关数据。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;从地形代理中和LOD数据中获取虚拟材质及其LOD数据。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;如果在编辑器或非发行版，更新LODSettings中绘制碰撞体的LOD设置。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;预计算虚拟阴影贴图的最大LOD，如果等于-1则不启用LOD，如果小于等于最大LOD则设为最大LOD，不然就根据和LOD屏幕占比的比较设置最贴近的LOD。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;获得地形组件三轴中最大的伸缩数值。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;获得静态光线分辨率，并创建储存光线信息的指针，判断是否使用地形裁切，通过光线信息指针中是否有光照贴图或阴影贴图判断是否真正使用静态光源。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;检查材质列表中每个材质的可用性，如果可用，检测材质实例的可用性，如果不可用，将其替换为默认材质；如果材质列表为空，则将默认材质加入列表。然后将材质接口转换为MaterialRelevances，即材质相关的featurelevel。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;通过SubsectionSize获得SharedBuffersKey。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;如果featurelevel是OpenGL ES3.1，将VisibilityWeightmap的texture和channel分别设置为从地形组件获得的WeightmapLayerAllocations对应的两个参数。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;如果在编辑器中，WeightmapLayerAllocation列表中的每个有效layerinfo加入到LayerColors列表中。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;将地形设为不透明，判断该场景在Lumen场景中的可见性。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;预计算将MipToMipMaxDeltas转换为世界空间中的对应值。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--80\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;130\&quot; width=\&quot;430\&quot; height=\&quot;1010\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--84\&quot; value=\&quot;TArray\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;10\&quot; y=\&quot;1180\&quot; width=\&quot;360\&quot; height=\&quot;320\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--85\&quot; value=\&quot;class\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--84\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;360\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--86\&quot; value=\&quot;&amp;lt;b&amp;gt;概述&amp;lt;/b&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;模板动态数组，假设储存的元素是可重定位的，即不通过构造函数直接移动到新内存，如部分struct。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;向数组中增删元素会使其他指向元素的指针失效，如删除（O(n)）会使后续元素索引失效。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--84\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;360\&quot; height=\&quot;120\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--87\&quot; value=\&quot;&amp;lt;b&amp;gt;函数&amp;lt;/b&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;SizeType AddDefaulted();&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;获得列表中新元素的分配内存地址在列表末尾，使用默认构造元素。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;SizeType AddDefaulted(SizeType Count);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;同上，但分配Count个元素的空间。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--84\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;180\&quot; width=\&quot;360\&quot; height=\&quot;140\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--88\&quot; value=\&quot;ULandscapeComponent\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;10\&quot; y=\&quot;1530\&quot; width=\&quot;360\&quot; height=\&quot;290\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--89\&quot; value=\&quot;class :&amp;amp;nbsp;UPrimitiveComponent\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--88\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;360\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--90\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--88\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;360\&quot; height=\&quot;120\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--91\&quot; value=\&quot;FPrimitiveSceneProxy* CreateSceneProxy();&amp;lt;div&amp;gt;将自己传入FLandscapeComponentSceneProxy(this)对地形组件场景代理进行构造。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--88\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;180\&quot; width=\&quot;360\&quot; height=\&quot;110\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--92\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;kv4tL4N_tAuuMEppTWd--91\&quot; target=\&quot;kv4tL4N_tAuuMEppTWd--80\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--93\&quot; value=\&quot;FPrimitiveSceneProxy\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;881\&quot; y=\&quot;1290\&quot; width=\&quot;360\&quot; height=\&quot;290\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--94\&quot; value=\&quot;class\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--93\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;360\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--95\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--93\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;360\&quot; height=\&quot;120\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;kv4tL4N_tAuuMEppTWd--96\&quot; value=\&quot;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;kv4tL4N_tAuuMEppTWd--93\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;180\&quot; width=\&quot;360\&quot; height=\&quot;110\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n      &lt;/root&gt;\n    &lt;/mxGraphModel&gt;\n  &lt;/diagram&gt;\n  &lt;diagram id=\&quot;jJhrst_Zmd0tHI0fUOSr\&quot; name=\&quot;类\&quot;&gt;\n    &lt;mxGraphModel dx=\&quot;1562\&quot; dy=\&quot;957\&quot; grid=\&quot;1\&quot; gridSize=\&quot;10\&quot; guides=\&quot;1\&quot; tooltips=\&quot;1\&quot; connect=\&quot;1\&quot; arrows=\&quot;1\&quot; fold=\&quot;1\&quot; page=\&quot;1\&quot; pageScale=\&quot;1\&quot; pageWidth=\&quot;827\&quot; pageHeight=\&quot;1169\&quot; math=\&quot;0\&quot; shadow=\&quot;0\&quot;&gt;\n      &lt;root&gt;\n        &lt;mxCell id=\&quot;0\&quot; /&gt;\n        &lt;mxCell id=\&quot;1\&quot; parent=\&quot;0\&quot; /&gt;\n        &lt;mxCell id=\&quot;cgBEG7MBzXsYJbjeqifA-3\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;1\&quot; source=\&quot;cgBEG7MBzXsYJbjeqifA-1\&quot; target=\&quot;cgBEG7MBzXsYJbjeqifA-2\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;cgBEG7MBzXsYJbjeqifA-1\&quot; value=\&quot;UObject\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;40\&quot; y=\&quot;40\&quot; width=\&quot;120\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;cgBEG7MBzXsYJbjeqifA-5\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;1\&quot; source=\&quot;cgBEG7MBzXsYJbjeqifA-2\&quot; target=\&quot;cgBEG7MBzXsYJbjeqifA-4\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;cgBEG7MBzXsYJbjeqifA-2\&quot; value=\&quot;UActorComponent\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;40\&quot; y=\&quot;150\&quot; width=\&quot;120\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;cgBEG7MBzXsYJbjeqifA-7\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;1\&quot; source=\&quot;cgBEG7MBzXsYJbjeqifA-4\&quot; target=\&quot;cgBEG7MBzXsYJbjeqifA-6\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;cgBEG7MBzXsYJbjeqifA-4\&quot; value=\&quot;USceneComponent\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;40\&quot; y=\&quot;260\&quot; width=\&quot;120\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;cgBEG7MBzXsYJbjeqifA-9\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;1\&quot; source=\&quot;cgBEG7MBzXsYJbjeqifA-6\&quot; target=\&quot;cgBEG7MBzXsYJbjeqifA-8\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;cgBEG7MBzXsYJbjeqifA-6\&quot; value=\&quot;UPrimitiveComponent\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;35\&quot; y=\&quot;370\&quot; width=\&quot;130\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;cgBEG7MBzXsYJbjeqifA-11\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;1\&quot; source=\&quot;cgBEG7MBzXsYJbjeqifA-8\&quot; target=\&quot;cgBEG7MBzXsYJbjeqifA-10\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;cgBEG7MBzXsYJbjeqifA-8\&quot; value=\&quot;UMeshComponent\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;40\&quot; y=\&quot;480\&quot; width=\&quot;120\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;cgBEG7MBzXsYJbjeqifA-13\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;\&quot; parent=\&quot;1\&quot; source=\&quot;cgBEG7MBzXsYJbjeqifA-8\&quot; target=\&quot;cgBEG7MBzXsYJbjeqifA-12\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;cgBEG7MBzXsYJbjeqifA-10\&quot; value=\&quot;UStaticMeshComponent\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;30\&quot; y=\&quot;590\&quot; width=\&quot;140\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;cgBEG7MBzXsYJbjeqifA-15\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;1\&quot; source=\&quot;cgBEG7MBzXsYJbjeqifA-12\&quot; target=\&quot;cgBEG7MBzXsYJbjeqifA-14\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;cgBEG7MBzXsYJbjeqifA-12\&quot; value=\&quot;USkinnedMeshComponent\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;190\&quot; y=\&quot;590\&quot; width=\&quot;160\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;cgBEG7MBzXsYJbjeqifA-14\&quot; value=\&quot;USkeletalMeshComponent\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;190\&quot; y=\&quot;700\&quot; width=\&quot;160\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n      &lt;/root&gt;\n    &lt;/mxGraphModel&gt;\n  &lt;/diagram&gt;\n  &lt;diagram id=\&quot;VnaAicCP0InVyQdOsbRe\&quot; name=\&quot;UE多线程\&quot;&gt;\n    &lt;mxGraphModel dx=\&quot;5207\&quot; dy=\&quot;3303\&quot; grid=\&quot;1\&quot; gridSize=\&quot;10\&quot; guides=\&quot;1\&quot; tooltips=\&quot;1\&quot; connect=\&quot;1\&quot; arrows=\&quot;1\&quot; fold=\&quot;1\&quot; page=\&quot;1\&quot; pageScale=\&quot;1\&quot; pageWidth=\&quot;827\&quot; pageHeight=\&quot;1169\&quot; math=\&quot;0\&quot; shadow=\&quot;0\&quot;&gt;\n      &lt;root&gt;\n        &lt;mxCell id=\&quot;0\&quot; /&gt;\n        &lt;mxCell id=\&quot;1\&quot; parent=\&quot;0\&quot; /&gt;\n        &lt;mxCell id=\&quot;Jf1PXix6-MB_zX6m7LZA-5\&quot; value=\&quot;&amp;lt;div&amp;gt;内存分配&amp;lt;/div&amp;gt;\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;30\&quot; y=\&quot;40\&quot; width=\&quot;260\&quot; height=\&quot;190\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;Jf1PXix6-MB_zX6m7LZA-1\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;待分配内存的大小处于(0, 32k)，使用MemSizeToPoolTable的PoolTable分配和存储。&amp;lt;/span&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;待分配内存的大小处于[32k, 48K]或者[64k, 96k]，使用PagePoolTable的PoolTable分配和存储。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;其它待分配内存的大小直接使用系统分配，且放入HashBuckets中。&amp;lt;/div&amp;gt;\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;align=left;\&quot; parent=\&quot;Jf1PXix6-MB_zX6m7LZA-5\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;25\&quot; width=\&quot;260\&quot; height=\&quot;165\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;hHTP-ihSQTMRbzUXGVJG-1\&quot; value=\&quot;内存屏障\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;330\&quot; y=\&quot;40\&quot; width=\&quot;470\&quot; height=\&quot;210\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;hHTP-ihSQTMRbzUXGVJG-2\&quot; value=\&quot;编译期内存屏障\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;hHTP-ihSQTMRbzUXGVJG-1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;200\&quot; height=\&quot;180\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;hHTP-ihSQTMRbzUXGVJG-4\&quot; value=\&quot;__COMPILE_MEMORY_BARRIER 在不同编译器上有不同的实现，加在两条指令中间，不让两条指令乱序。\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;align=left;\&quot; parent=\&quot;hHTP-ihSQTMRbzUXGVJG-2\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;200\&quot; height=\&quot;150\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;hHTP-ihSQTMRbzUXGVJG-3\&quot; value=\&quot;运行期内存屏障\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;hHTP-ihSQTMRbzUXGVJG-1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;200\&quot; y=\&quot;30\&quot; width=\&quot;270\&quot; height=\&quot;180\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;hHTP-ihSQTMRbzUXGVJG-5\&quot; value=\&quot;&amp;lt;b&amp;gt;读屏障（Load barrier）&amp;lt;/b&amp;gt;&amp;lt;div&amp;gt;插入到指令前能强制指令从内存加载数据。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;写屏障（Store barrier）&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;插入到指令后能强制缓存中的数据写入内存。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;能组成loadload，storestore，loadstore，storeload，四种屏障。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;UE封装的是各平台和图像api的运行时屏障&amp;lt;/div&amp;gt;\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;align=left;\&quot; parent=\&quot;hHTP-ihSQTMRbzUXGVJG-3\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;270\&quot; height=\&quot;150\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;eoBgBGN3yxJC5U8v9c7i-1\&quot; value=\&quot;命令列队\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;30\&quot; y=\&quot;250\&quot; width=\&quot;200\&quot; height=\&quot;200\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;eoBgBGN3yxJC5U8v9c7i-2\&quot; value=\&quot;DirectX 12在用户层面有三种命令列队，GPU在硬件层面有三种引擎：&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;复制列队/引擎，计算列队/引擎，3D列队/引擎。&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;3D列队能调用GPU三种引擎，计算列队能调用计算和复制引擎，复制列队只能调用复制引擎。&amp;lt;/div&amp;gt;\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;align=left;\&quot; parent=\&quot;eoBgBGN3yxJC5U8v9c7i-1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;25\&quot; width=\&quot;200\&quot; height=\&quot;175\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;eoBgBGN3yxJC5U8v9c7i-3\&quot; value=\&quot;\&quot; style=\&quot;shape=image;verticalLabelPosition=bottom;labelBackgroundColor=default;verticalAlign=top;aspect=fixed;imageAspect=0;image=https://img2020.cnblogs.com/blog/1617944/202101/1617944-20210125210324897-639832403.png;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;248.39\&quot; y=\&quot;270\&quot; width=\&quot;251.61\&quot; height=\&quot;210\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;eoBgBGN3yxJC5U8v9c7i-4\&quot; value=\&quot;\&quot; style=\&quot;shape=image;verticalLabelPosition=bottom;labelBackgroundColor=default;verticalAlign=top;aspect=fixed;imageAspect=0;image=https://img2020.cnblogs.com/blog/1617944/202101/1617944-20210125210555966-1110432322.jpg;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;520\&quot; y=\&quot;280\&quot; width=\&quot;280\&quot; height=\&quot;115.2\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; value=\&quot;TaskGraph 任务图\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;836\&quot; y=\&quot;10\&quot; width=\&quot;810\&quot; height=\&quot;1640\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;zKjAbSvFhS5QDGIudktn-3\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; source=\&quot;zKjAbSvFhS5QDGIudktn-1\&quot; target=\&quot;zKjAbSvFhS5QDGIudktn-2\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;yVyFt0LPaHP_OQzGcd6w-9\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;dashPattern=8 8;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; source=\&quot;zKjAbSvFhS5QDGIudktn-1\&quot; target=\&quot;yVyFt0LPaHP_OQzGcd6w-8\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;zKjAbSvFhS5QDGIudktn-1\&quot; value=\&quot;FBaseGraphTask\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;194.5\&quot; y=\&quot;190\&quot; width=\&quot;120\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;yVyFt0LPaHP_OQzGcd6w-5\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.25;exitDx=0;exitDy=0;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; source=\&quot;zKjAbSvFhS5QDGIudktn-2\&quot; target=\&quot;XFnZvKqLEREH3KkuAl9b-7\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;yVyFt0LPaHP_OQzGcd6w-11\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;dashPattern=8 8;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; source=\&quot;zKjAbSvFhS5QDGIudktn-2\&quot; target=\&quot;yVyFt0LPaHP_OQzGcd6w-10\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;JvB-WbyxHMWl8aR3Ws-V-1\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;exitX=1;exitY=0.75;exitDx=0;exitDy=0;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; source=\&quot;zKjAbSvFhS5QDGIudktn-2\&quot; target=\&quot;XFnZvKqLEREH3KkuAl9b-13\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint x=\&quot;320\&quot; y=\&quot;300\&quot; as=\&quot;sourcePoint\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;zKjAbSvFhS5QDGIudktn-2\&quot; value=\&quot;TGraphTask\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;194.5\&quot; y=\&quot;270\&quot; width=\&quot;120\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;XFnZvKqLEREH3KkuAl9b-4\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; source=\&quot;XFnZvKqLEREH3KkuAl9b-1\&quot; target=\&quot;XFnZvKqLEREH3KkuAl9b-3\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;XFnZvKqLEREH3KkuAl9b-1\&quot; value=\&quot;FAsyncGraphTaskBase\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;14.5\&quot; y=\&quot;190\&quot; width=\&quot;140\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;XFnZvKqLEREH3KkuAl9b-5\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; source=\&quot;XFnZvKqLEREH3KkuAl9b-3\&quot; target=\&quot;zKjAbSvFhS5QDGIudktn-2\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;3Ngba8GRH5Lr84mie2op-6\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;dashPattern=8 8;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; source=\&quot;XFnZvKqLEREH3KkuAl9b-3\&quot; target=\&quot;3Ngba8GRH5Lr84mie2op-5\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;XFnZvKqLEREH3KkuAl9b-3\&quot; value=\&quot;TAsyncGraphTask\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;24.5\&quot; y=\&quot;270\&quot; width=\&quot;120\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;XFnZvKqLEREH3KkuAl9b-10\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; source=\&quot;XFnZvKqLEREH3KkuAl9b-6\&quot; target=\&quot;XFnZvKqLEREH3KkuAl9b-7\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;XFnZvKqLEREH3KkuAl9b-11\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; source=\&quot;XFnZvKqLEREH3KkuAl9b-6\&quot; target=\&quot;XFnZvKqLEREH3KkuAl9b-7\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;XFnZvKqLEREH3KkuAl9b-12\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; source=\&quot;XFnZvKqLEREH3KkuAl9b-6\&quot; target=\&quot;XFnZvKqLEREH3KkuAl9b-7\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;yVyFt0LPaHP_OQzGcd6w-1\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; source=\&quot;XFnZvKqLEREH3KkuAl9b-6\&quot; target=\&quot;XFnZvKqLEREH3KkuAl9b-13\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;XFnZvKqLEREH3KkuAl9b-6\&quot; value=\&quot;FTaskThreadBase\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;364.5\&quot; y=\&quot;190\&quot; width=\&quot;120\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;3Ngba8GRH5Lr84mie2op-2\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;dashPattern=8 8;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; source=\&quot;XFnZvKqLEREH3KkuAl9b-7\&quot; target=\&quot;3Ngba8GRH5Lr84mie2op-1\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;XFnZvKqLEREH3KkuAl9b-7\&quot; value=\&quot;FNamedTaskThread\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;364.5\&quot; y=\&quot;260\&quot; width=\&quot;120\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;3Ngba8GRH5Lr84mie2op-4\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;dashPattern=8 8;exitX=0.75;exitY=0;exitDx=0;exitDy=0;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; source=\&quot;XFnZvKqLEREH3KkuAl9b-13\&quot; target=\&quot;3Ngba8GRH5Lr84mie2op-3\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;XFnZvKqLEREH3KkuAl9b-13\&quot; value=\&quot;FTaskThreadAnyThread\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;504.5\&quot; y=\&quot;270\&quot; width=\&quot;140\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;yVyFt0LPaHP_OQzGcd6w-8\&quot; value=\&quot;任务父类，其子类才会执行任务，其虚函数 ExecuteTask 需由子类实现。\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;align=left;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;154.5\&quot; y=\&quot;80\&quot; width=\&quot;170\&quot; height=\&quot;60\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;yVyFt0LPaHP_OQzGcd6w-10\&quot; value=\&quot;是传入TTask的模板类。由辅助类FConstructor创建TTask任务对象。创建任务时，会根据传入的任务数据设置先决和后续任务。执行任务后会继续执行后续任务，如有。\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;align=left;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;114.5\&quot; y=\&quot;450\&quot; width=\&quot;200\&quot; height=\&quot;90\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;3Ngba8GRH5Lr84mie2op-1\&quot; value=\&quot;带名字的任务线程实例，有两种执行模式，一是不停执行任务直到关闭或不支持多线程，没有返回值；二是直到列队中没有任务后就停下，返回执行完的任务数量。任务能从当前线程和其他线程入队。\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;align=left;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;329.5\&quot; y=\&quot;352.5\&quot; width=\&quot;190\&quot; height=\&quot;115\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;3Ngba8GRH5Lr84mie2op-3\&quot; value=\&quot;从任务图系统中的无名列队中获取任务，而不是像namedtaskthread那样从自己的列队中获取。其他方面两者都差不多。\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;align=left;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;470\&quot; y=\&quot;65\&quot; width=\&quot;174.5\&quot; height=\&quot;90\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;3Ngba8GRH5Lr84mie2op-5\&quot; value=\&quot;将要执行的任务传入该类或直接继承该类。拥有执行函数DoTask。该类会传入TGraphTask被他管理调用。\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;align=left;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;4.5\&quot; y=\&quot;360\&quot; width=\&quot;190\&quot; height=\&quot;76\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;JvB-WbyxHMWl8aR3Ws-V-7\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; source=\&quot;JvB-WbyxHMWl8aR3Ws-V-2\&quot; target=\&quot;JvB-WbyxHMWl8aR3Ws-V-6\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;JvB-WbyxHMWl8aR3Ws-V-2\&quot; value=\&quot;FTaskGraphInterface\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;44\&quot; y=\&quot;585\&quot; width=\&quot;120\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;JvB-WbyxHMWl8aR3Ws-V-5\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; source=\&quot;JvB-WbyxHMWl8aR3Ws-V-3\&quot; target=\&quot;JvB-WbyxHMWl8aR3Ws-V-4\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;JvB-WbyxHMWl8aR3Ws-V-3\&quot; value=\&quot;ENamedThreads\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;607\&quot; y=\&quot;352.5\&quot; width=\&quot;120\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;JvB-WbyxHMWl8aR3Ws-V-4\&quot; value=\&quot;这是一个命名空间。里面声明了一个enum枚举变量Type，统一设置了各种标签：和线程，队列相关的索引，优先级，掩码，偏移等，还有它们的位运算组合标记。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;还有处理这些线程相关数据的函数接口。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;rounded=0;align=left;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;554\&quot; y=\&quot;442.5\&quot; width=\&quot;226\&quot; height=\&quot;100\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;JvB-WbyxHMWl8aR3Ws-V-6\&quot; value=\&quot;任务图的管理器，申明了对它自己，线程，任务相关的操作接口。\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;31\&quot; y=\&quot;680\&quot; width=\&quot;146\&quot; height=\&quot;50\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;JvB-WbyxHMWl8aR3Ws-V-8\&quot; value=\&quot;FTaskGraphImplementation\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;300\&quot; y=\&quot;560\&quot; width=\&quot;480\&quot; height=\&quot;720\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;JvB-WbyxHMWl8aR3Ws-V-9\&quot; value=\&quot;class : public FtaskGraphInterface\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; parent=\&quot;JvB-WbyxHMWl8aR3Ws-V-8\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;480\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;JvB-WbyxHMWl8aR3Ws-V-10\&quot; value=\&quot;static FTaskGraphImplementation&amp;amp;amp; Get();&amp;lt;div&amp;gt;用于外侧获取该类实例。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;virtual void QueueTask(FBaseGraphTask* Task, ENamedThreads::Type ThreadToExecuteOn, ENamedThreads::Type InCurrentThreadIfKnown = ENamedThreads::AnyThread) final override;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;将任务推入队列，传入任务指针和表明执行线程和当前线程的Type枚举。对多线程和单线程环境都有做出支持。在多线程环境下，会根据传入参数和从任务指针中获取的信息处理任务优先级，然后加入对应执行队列。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;还有多个任务处理接口，任务调度接口的实现。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;JvB-WbyxHMWl8aR3Ws-V-8\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;480\&quot; height=\&quot;170\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;JvB-WbyxHMWl8aR3Ws-V-11\&quot; value=\&quot;FWorkerThread WorkerThreads[MAX_THRESDS]&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;所有工作线程（任务线程）对象的数组。&amp;lt;/span&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;int32 NumThreads;&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;实际使用的线程数量。&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;int32 NumNamedThreads; 专用线程的数量。&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;int32 NumTaslThreadSets; 任务线程集的数量。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;int32 NumTaskThreadsPerSet; 单个集拥有的任务线程数量。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;bool bCreatedHiPriorityThreads; 是否创建了高优先度线程。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;bool bCreatedBackgroundPriorityThreads; 是否创建了后台（最低优先级）线程。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;ENamedThreads::Type LastExternalThread; 最后外部线程，一般为实际渲染线程。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;FThreadSafeCounter ReentrancyCheck;&amp;amp;nbsp;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;uint32 PerThreadIDTLSSlot; 每个线程内缓存的大小。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;TArray&amp;amp;lt;TFunction&amp;amp;lt;void()&amp;amp;gt;&amp;amp;gt; ShoutdownCallback; 销毁前的回调函数列表。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;FStallingTaskQueue&amp;amp;lt;FBaseGraphTask, PLATFORM_CACHE_LINE_SIZE, 2&amp;amp;gt; IncomingAnyThreadTasks[MAX_THREAD_PRIORITIES];&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;这是一个二维数据结构，由多个不同优先度的任务队列组成。将任务入队时，会件将任务推入对应优先度的队列中，并返回可执行的任务索引，后续会根据该索引启用对应工作线程执行任务。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;JvB-WbyxHMWl8aR3Ws-V-8\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;230\&quot; width=\&quot;480\&quot; height=\&quot;330\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tA4ZCZlxT6F0voV1dP9b-1\&quot; value=\&quot;FTaskGraphImplementation(int32);&amp;lt;div&amp;gt;检测是否创建高优先和后台线程。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;根据硬件获得任务线程数量。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;如果不支持多线程，所有任务都在主线程游戏线程中执行。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;计算真正需要的工作线程数量。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;创建所有线程：创建多个专用线程和多个无名（通用）线程，创建同时会设置其优先级等信息。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;若是专用线程，直接通过FNamedTaskThread在WorkerThreads[ThreadIndex]中创建。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;若是通用线程，会使用FRunableThread&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;在WorkerThreads[ThreadIndex]中创建。&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;JvB-WbyxHMWl8aR3Ws-V-8\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;560\&quot; width=\&quot;480\&quot; height=\&quot;160\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;JvB-WbyxHMWl8aR3Ws-V-12\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; source=\&quot;JvB-WbyxHMWl8aR3Ws-V-9\&quot; target=\&quot;JvB-WbyxHMWl8aR3Ws-V-2\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tA4ZCZlxT6F0voV1dP9b-2\&quot; value=\&quot;FWorkerThread\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;24.5\&quot; y=\&quot;790\&quot; width=\&quot;250\&quot; height=\&quot;190\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tA4ZCZlxT6F0voV1dP9b-3\&quot; value=\&quot;struct\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; parent=\&quot;tA4ZCZlxT6F0voV1dP9b-2\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;250\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tA4ZCZlxT6F0voV1dP9b-4\&quot; value=\&quot;&amp;lt;div&amp;gt;FTaskThreadBase* TaskGraphWorker;&amp;amp;nbsp;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;所在的FTaskThread对象&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;FRunnableThread* RunnableThread;&amp;amp;nbsp;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;真正执行任务的线程&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;bool bAttached；&amp;amp;nbsp;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;是否附加的线程，一般用于专用线程。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;tA4ZCZlxT6F0voV1dP9b-2\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;250\&quot; height=\&quot;130\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;tA4ZCZlxT6F0voV1dP9b-8\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.003;entryY=0.043;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; source=\&quot;tA4ZCZlxT6F0voV1dP9b-2\&quot; target=\&quot;JvB-WbyxHMWl8aR3Ws-V-11\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;t3I-41hBY21D7pMY7zJ7-6\&quot; value=\&quot;新建线程\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;24.5\&quot; y=\&quot;1310\&quot; width=\&quot;480\&quot; height=\&quot;140\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;t3I-41hBY21D7pMY7zJ7-3\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;t3I-41hBY21D7pMY7zJ7-6\&quot; source=\&quot;t3I-41hBY21D7pMY7zJ7-1\&quot; target=\&quot;t3I-41hBY21D7pMY7zJ7-2\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;t3I-41hBY21D7pMY7zJ7-1\&quot; value=\&quot;FRunnable\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;t3I-41hBY21D7pMY7zJ7-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;20\&quot; y=\&quot;40\&quot; width=\&quot;120\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;t3I-41hBY21D7pMY7zJ7-5\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;t3I-41hBY21D7pMY7zJ7-6\&quot; source=\&quot;t3I-41hBY21D7pMY7zJ7-2\&quot; target=\&quot;t3I-41hBY21D7pMY7zJ7-4\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;t3I-41hBY21D7pMY7zJ7-2\&quot; value=\&quot;FRunnableThread\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;t3I-41hBY21D7pMY7zJ7-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;180\&quot; y=\&quot;40\&quot; width=\&quot;120\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;t3I-41hBY21D7pMY7zJ7-4\&quot; value=\&quot;FThreadManager\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;t3I-41hBY21D7pMY7zJ7-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;340\&quot; y=\&quot;40\&quot; width=\&quot;120\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;t3I-41hBY21D7pMY7zJ7-7\&quot; value=\&quot;创建新线程时，将继承FRunnable的将要运行的类在新建的FRunnableThread中创建，新建的thread会自动装入FThreadManager中。\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;align=left;\&quot; parent=\&quot;t3I-41hBY21D7pMY7zJ7-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;90\&quot; width=\&quot;480\&quot; height=\&quot;50\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;t3I-41hBY21D7pMY7zJ7-11\&quot; value=\&quot;列队线程池\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;yVyFt0LPaHP_OQzGcd6w-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;24.5\&quot; y=\&quot;1470\&quot; width=\&quot;520\&quot; height=\&quot;140\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;t3I-41hBY21D7pMY7zJ7-12\&quot; value=\&quot;在创建了一个queued thread pool后，当有任务时，新建queued work加入到pool里。queued thread对象持续的从有任务的pool中获取任务来执行。\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;align=left;\&quot; parent=\&quot;t3I-41hBY21D7pMY7zJ7-11\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;90\&quot; width=\&quot;520\&quot; height=\&quot;50\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;t3I-41hBY21D7pMY7zJ7-10\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;t3I-41hBY21D7pMY7zJ7-11\&quot; source=\&quot;t3I-41hBY21D7pMY7zJ7-8\&quot; target=\&quot;t3I-41hBY21D7pMY7zJ7-9\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;t3I-41hBY21D7pMY7zJ7-8\&quot; value=\&quot;TAsyncQueuedWork\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;t3I-41hBY21D7pMY7zJ7-11\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;20\&quot; y=\&quot;40\&quot; width=\&quot;120\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;6hGNKgj4HFJEpCrfyCTo-2\&quot; value=\&quot;\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;\&quot; parent=\&quot;t3I-41hBY21D7pMY7zJ7-11\&quot; source=\&quot;t3I-41hBY21D7pMY7zJ7-9\&quot; target=\&quot;6hGNKgj4HFJEpCrfyCTo-1\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;t3I-41hBY21D7pMY7zJ7-9\&quot; value=\&quot;FQueuedThreadPoolBase\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;t3I-41hBY21D7pMY7zJ7-11\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;180\&quot; y=\&quot;40\&quot; width=\&quot;160\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;6hGNKgj4HFJEpCrfyCTo-1\&quot; value=\&quot;FQueuedThread\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;t3I-41hBY21D7pMY7zJ7-11\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;380\&quot; y=\&quot;40\&quot; width=\&quot;120\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-1\&quot; value=\&quot;游戏线程\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;560\&quot; y=\&quot;420\&quot; width=\&quot;200\&quot; height=\&quot;140\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-2\&quot; value=\&quot;同时是主线程，TaskGraph中的ENamedThreads::GameThread。在程序启动时创建并储存到全局变量GGameThreadId中，稍后会设置到TaskGraph中。\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;200\&quot; height=\&quot;110\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-3\&quot; value=\&quot;渲染线程\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;54\&quot; y=\&quot;590\&quot; width=\&quot;720\&quot; height=\&quot;750\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-4\&quot; value=\&quot;RenderingThread.h\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-3\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;10\&quot; y=\&quot;40\&quot; width=\&quot;170\&quot; height=\&quot;60\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-5\&quot; value=\&quot;申明了全部的对外接口。\&quot; style=\&quot;text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-4\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;5\&quot; y=\&quot;30\&quot; width=\&quot;160\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-6\&quot; value=\&quot;ENQUEUE_RENDER_COMMAND\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-3\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;10\&quot; y=\&quot;110\&quot; width=\&quot;270\&quot; height=\&quot;120\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-13\&quot; value=\&quot;&amp;lt;div&amp;gt;宏，用于向渲染线程入队渲染命令。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;先创建用于被调用的字符串字面量，然后调用EnqueueUniqueRenderCommand并把传入的type和lambda（如有）传入该函数。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;270\&quot; height=\&quot;90\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-16\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.75;entryDx=0;entryDy=0;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-3\&quot; source=\&quot;0Z8-jVNF1-ioApsdYkYJ-14\&quot; target=\&quot;0Z8-jVNF1-ioApsdYkYJ-13\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-14\&quot; value=\&quot;EnqueueUniqueRenderCommand\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-3\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;10\&quot; y=\&quot;270\&quot; width=\&quot;270\&quot; height=\&quot;220\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-15\&quot; value=\&quot;将type字面量和lambda传入模板类TEnqueueUniqueRenderCommandType定义一个用于渲染命令的TaskGraph任务类EURCType。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;根据线程情况判断处理方式：&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;如果正在渲染线程内，则直接执行任务。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;如果不在渲染线程并且需要在渲染线程执行，则创建EURCType的GraphTask并在适当的时候入队命令。&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;如果不需要在渲染线程执行，则直接在当前线程执行。&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-14\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;270\&quot; height=\&quot;190\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-17\&quot; value=\&quot;TEnqueueUniqueRenderCommandType\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-3\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;10\&quot; y=\&quot;530\&quot; width=\&quot;340\&quot; height=\&quot;180\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-18\&quot; value=\&quot;继承自FRenderComand，其拥有两个函数：&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;static ENamedThreads::Type GetDesiredThread();&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;static ESubsequentsMode::Type GetSubsequentsMode();&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;初始化时会储存传入的渲染回调函数。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;由该函数执行函数：&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;void DoTask(ENamedThreads::Type CurrentThread, const FGraphEventRef&amp;amp;amp; MyCompletionGraphEvent);&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-17\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;340\&quot; height=\&quot;150\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-19\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.158;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-3\&quot; source=\&quot;0Z8-jVNF1-ioApsdYkYJ-17\&quot; target=\&quot;0Z8-jVNF1-ioApsdYkYJ-15\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-20\&quot; value=\&quot;FRenderingThread\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-3\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;334\&quot; y=\&quot;200\&quot; width=\&quot;360\&quot; height=\&quot;300\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-21\&quot; value=\&quot;class : public FRunnbale\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-20\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;360\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-22\&quot; value=\&quot;其承载了渲染线程的主要工作。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;其中由两个主要函数：&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;virtual bool Init(void) override;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;将当前线程设为选举变量，方便其他地方引用。然后检测是否存在RHI线程并处理捕获关系。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;virtual uint32 Run(void) override;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;设置渲染线程的线程内缓存和平台渲染数据。然后调用RenderingThreadMain进入渲染主循环。在循环结束后会清楚缓存。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-20\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;360\&quot; height=\&quot;170\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-23\&quot; value=\&quot;FRenderingThread();&amp;lt;div&amp;gt;默认设置为不需要被其他线程捕获，即没有RHI线程。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;从事件池中获得同步事件。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;清空RHI资源。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-20\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;230\&quot; width=\&quot;360\&quot; height=\&quot;70\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-24\&quot; value=\&quot;RenderingThreadMain\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-3\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;394\&quot; y=\&quot;510\&quot; width=\&quot;246\&quot; height=\&quot;150\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-25\&quot; value=\&quot;设置渲染线程和局部线程插槽。&amp;lt;div&amp;gt;将当前线程附加到TaskGraph的渲染线程插槽中。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;触发同步事件，通知主线程TaskGraph已就绪。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;处理各个阶段的渲染线程。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;处理完后转到游戏线程。&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-24\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;240\&quot; height=\&quot;120\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-26\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.859;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0;exitY=0.091;exitDx=0;exitDy=0;exitPerimeter=0;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-3\&quot; source=\&quot;0Z8-jVNF1-ioApsdYkYJ-24\&quot; target=\&quot;0Z8-jVNF1-ioApsdYkYJ-22\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-27\&quot; value=\&quot;StartRenderingThread\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-3\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;384\&quot; y=\&quot;40\&quot; width=\&quot;250\&quot; height=\&quot;150\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-28\&quot; value=\&quot;&amp;lt;div&amp;gt;在FRngineLoop::PreInitPostStartupScreen中被调用。用于在PreInit阶段创建渲染线程。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;开启多线程渲染标志。&amp;lt;div&amp;gt;创建FRenderingThread实例。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;使用FRunnableThread::Create创建渲染线程。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;开启渲染命令栅栏。&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-27\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;250\&quot; height=\&quot;120\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;0Z8-jVNF1-ioApsdYkYJ-29\&quot; value=\&quot;RHI线程\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;54\&quot; y=\&quot;1360\&quot; width=\&quot;720\&quot; height=\&quot;602\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;5-99jWCTfatgsFoPphaE-1\&quot; value=\&quot;FRHIThread\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-29\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;30\&quot; y=\&quot;252\&quot; width=\&quot;320\&quot; height=\&quot;270\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;5-99jWCTfatgsFoPphaE-2\&quot; value=\&quot;class : public FRunnbale\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; parent=\&quot;5-99jWCTfatgsFoPphaE-1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;320\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;5-99jWCTfatgsFoPphaE-3\&quot; value=\&quot;转换渲染指令为API，创建或上传资源到GPU。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;static FRHIThread&amp;amp;amp; Get();&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;通过局部静态实现单例。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;void Start();&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;创建runnable thread线程。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;virtual uint32 Run() override;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;初始化TLS，然后通过FTaskGraphInterface将线程附加到taskgraph并启动线程，直到返回。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;5-99jWCTfatgsFoPphaE-1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;320\&quot; height=\&quot;170\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;5-99jWCTfatgsFoPphaE-4\&quot; value=\&quot;FRHIThread();&amp;lt;div&amp;gt;将rhi线程指针初始化为nullptr。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;5-99jWCTfatgsFoPphaE-1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;230\&quot; width=\&quot;320\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;5-99jWCTfatgsFoPphaE-5\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;\&quot; parent=\&quot;5-99jWCTfatgsFoPphaE-1\&quot; source=\&quot;5-99jWCTfatgsFoPphaE-4\&quot; target=\&quot;5-99jWCTfatgsFoPphaE-4\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;5-99jWCTfatgsFoPphaE-6\&quot; value=\&quot;StartRenderingThread\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-29\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;30\&quot; y=\&quot;52\&quot; width=\&quot;250\&quot; height=\&quot;158\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;5-99jWCTfatgsFoPphaE-7\&quot; value=\&quot;&amp;lt;div&amp;gt;在FRngineLoop::PreInitPostStartupScreen中被调用。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;判断是否启用rhi线程。&amp;lt;div&amp;gt;创建FRHIThread实例并启用它。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;创建RHI线程的拥有者捕获，然后让局部游戏线程等待直到捕获rhi线程拥有者。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;储存rhi线程id到全局并设置相关标志。&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;5-99jWCTfatgsFoPphaE-6\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;250\&quot; height=\&quot;120\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;zGmdmfr5FRtx44n8xgnG-1\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.583;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-29\&quot; source=\&quot;5-99jWCTfatgsFoPphaE-1\&quot; target=\&quot;5-99jWCTfatgsFoPphaE-7\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;zGmdmfr5FRtx44n8xgnG-2\&quot; value=\&quot;FRHICommandBase\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-29\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;370\&quot; y=\&quot;62\&quot; width=\&quot;330\&quot; height=\&quot;148\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;zGmdmfr5FRtx44n8xgnG-3\&quot; value=\&quot;&amp;lt;div&amp;gt;RHI指令结构体。指令由链表形式串联。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;FRHICommandBase* Next = nullptr;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;指向下一条指令。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;virtual ExecuteAndDestruct(FRHICommandBase&amp;amp;amp; CmdList, FRHICommandListDebugContext&amp;amp;amp; DebugContext) = 0;&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;zGmdmfr5FRtx44n8xgnG-2\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;330\&quot; height=\&quot;120\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;zGmdmfr5FRtx44n8xgnG-7\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-29\&quot; source=\&quot;zGmdmfr5FRtx44n8xgnG-4\&quot; target=\&quot;zGmdmfr5FRtx44n8xgnG-3\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;zGmdmfr5FRtx44n8xgnG-4\&quot; value=\&quot;FRHICommand\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-29\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;415\&quot; y=\&quot;242\&quot; width=\&quot;240\&quot; height=\&quot;108\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;zGmdmfr5FRtx44n8xgnG-5\&quot; value=\&quot;模板，重写ExecuteAndDestruct。执行传入的指令后析构指令。\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;zGmdmfr5FRtx44n8xgnG-4\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;240\&quot; height=\&quot;50\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;zGmdmfr5FRtx44n8xgnG-6\&quot; value=\&quot;struct : FRHICommandBase\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;zGmdmfr5FRtx44n8xgnG-4\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;240\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;zGmdmfr5FRtx44n8xgnG-8\&quot; value=\&quot;FRHICOMMAND_MACRO\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;0Z8-jVNF1-ioApsdYkYJ-29\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;415\&quot; y=\&quot;382\&quot; width=\&quot;240\&quot; height=\&quot;130\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;zGmdmfr5FRtx44n8xgnG-9\&quot; value=\&quot;通过宏FRHICOMMAND_MACRO(FRHIxxx)预先实现上百个RHI指令用于向RHI线程发送命令，将对应指令推入RHI队列并执行。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;各个指令的Execute实现被定义在RHICommandListCommandExecute.inl中。&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;zGmdmfr5FRtx44n8xgnG-8\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;240\&quot; height=\&quot;100\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-13\&quot; value=\&quot;游戏线程和渲染线程交互\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;881\&quot; y=\&quot;1690\&quot; width=\&quot;689\&quot; height=\&quot;480\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-4\&quot; value=\&quot;UActorComponent::&amp;lt;div&amp;gt;DoDeferredRenderUpdates_Concurrent()&amp;lt;/div&amp;gt;\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;M8rM-Tge_Ed46IPA60Hi-13\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;361\&quot; y=\&quot;50\&quot; width=\&quot;290\&quot; height=\&quot;150\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-6\&quot; value=\&quot;用于PrimitiveComponent向RrimitiveSceneProxy更新数据。\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; parent=\&quot;M8rM-Tge_Ed46IPA60Hi-4\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;290\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-10\&quot; value=\&quot;判断renderstate，rendertransform，和renderdynamicdata上是否有更新，然后调用对应的更新函数进行更新。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;子类可以对更新函数进行覆写实现自己的更新逻辑。&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;M8rM-Tge_Ed46IPA60Hi-4\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;70\&quot; width=\&quot;290\&quot; height=\&quot;80\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-1\&quot; value=\&quot;FScene::AddPrimitive&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;UPrimitiveComponent* Primitive)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;M8rM-Tge_Ed46IPA60Hi-13\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;40\&quot; y=\&quot;50\&quot; width=\&quot;240\&quot; height=\&quot;240\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-2\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: initial;&amp;quot;&amp;gt;通过传入的Primitive创建图元的场景代理PrimitiveSceneProxy，再将代理储存在它的变量SceneProxy中。&amp;lt;/span&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;通过Primitive和当前场景this创建场景代理的场景信息PrimitiveSceneInfo，并存入代理的变量中。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;调用ENQUEUE_RENDER_COMMAND将场景信息传到渲染线程。&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;M8rM-Tge_Ed46IPA60Hi-1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;80\&quot; width=\&quot;240\&quot; height=\&quot;160\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-3\&quot; value=\&quot;&amp;lt;span style=&amp;quot;&amp;quot;&amp;gt;通过PrimitiveSceneProxy复制PrimitiveComponent的全部数据，将其传入渲染线程。&amp;lt;/span&amp;gt;\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;align=left;\&quot; parent=\&quot;M8rM-Tge_Ed46IPA60Hi-1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;240\&quot; height=\&quot;50\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-16\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;\&quot; parent=\&quot;M8rM-Tge_Ed46IPA60Hi-13\&quot; source=\&quot;M8rM-Tge_Ed46IPA60Hi-11\&quot; target=\&quot;M8rM-Tge_Ed46IPA60Hi-10\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-11\&quot; value=\&quot;UActorComponent::&amp;lt;div&amp;gt;CreateRenderState_Concurrent(&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;FRegisterComponentContext* Context)&amp;lt;/div&amp;gt;\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=50;\&quot; parent=\&quot;M8rM-Tge_Ed46IPA60Hi-13\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;400\&quot; y=\&quot;240\&quot; width=\&quot;240\&quot; height=\&quot;100\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-12\&quot; value=\&quot;通过设置nXxxDirty标识来初始化RenderState；这些标识用来判断对应数据是否更新。\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;M8rM-Tge_Ed46IPA60Hi-11\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;50\&quot; width=\&quot;240\&quot; height=\&quot;50\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-14\&quot; value=\&quot;FScene::UpdateLightTransform(ULightComponent* Light)\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;M8rM-Tge_Ed46IPA60Hi-13\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;40\&quot; y=\&quot;310\&quot; width=\&quot;300\&quot; height=\&quot;150\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-15\&quot; value=\&quot;对于场景光照移动的更新，和AddPrimitice类似。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;先将光照的位置信息和变换矩阵存入专属的参数类Parameters，然后获得Scene和LightSceneInfo。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;调用ENQUEUE_RENDER_COMMAND将这三个数据传入并调用对应的渲染线程的更新函数更新。&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;M8rM-Tge_Ed46IPA60Hi-14\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;300\&quot; height=\&quot;120\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-18\&quot; value=\&quot;游戏线程和渲染线程同步\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;1\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;54\&quot; y=\&quot;1980\&quot; width=\&quot;720\&quot; height=\&quot;270\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-19\&quot; value=\&quot;FRenderCommandFence\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;M8rM-Tge_Ed46IPA60Hi-18\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;10\&quot; y=\&quot;98\&quot; width=\&quot;310\&quot; height=\&quot;160\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-20\&quot; value=\&quot;void BeginFence(bool bSyncToRHIAndGPU = false);&amp;lt;div&amp;gt;向渲染列队增加一个栅栏。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;void Wait(bool bProcessGameThreadTsks = false) const;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;等待栅栏被执行。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;bool IsFenceComplete() const;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;是否完成栅栏。&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;M8rM-Tge_Ed46IPA60Hi-19\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;310\&quot; height=\&quot;130\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-24\&quot; value=\&quot;FEngineLoop::Tick\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; parent=\&quot;M8rM-Tge_Ed46IPA60Hi-18\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;284\&quot; y=\&quot;40\&quot; width=\&quot;120\&quot; height=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-25\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;\&quot; parent=\&quot;M8rM-Tge_Ed46IPA60Hi-18\&quot; source=\&quot;M8rM-Tge_Ed46IPA60Hi-21\&quot; target=\&quot;M8rM-Tge_Ed46IPA60Hi-24\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-21\&quot; value=\&quot;FFrameEndSync\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; parent=\&quot;M8rM-Tge_Ed46IPA60Hi-18\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;360\&quot; y=\&quot;98\&quot; width=\&quot;270\&quot; height=\&quot;160\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-22\&quot; value=\&quot;FRenderCommandFence Fence[2]; 渲染栅栏对。&amp;lt;div&amp;gt;int32 EventIndex; 当前事件索引。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;void Sync(bool bAllowOneFreameThreadLag);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;先开启当前事件的栅栏，同步RHI和GPU。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;让游戏线程至少跑过一次任务。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;如果允许一帧延迟，交换事件索引。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;最后等待栅栏。&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; parent=\&quot;M8rM-Tge_Ed46IPA60Hi-21\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;270\&quot; height=\&quot;130\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;M8rM-Tge_Ed46IPA60Hi-23\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.077;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; parent=\&quot;M8rM-Tge_Ed46IPA60Hi-18\&quot; source=\&quot;M8rM-Tge_Ed46IPA60Hi-19\&quot; target=\&quot;M8rM-Tge_Ed46IPA60Hi-22\&quot; edge=\&quot;1\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n      &lt;/root&gt;\n    &lt;/mxGraphModel&gt;\n  &lt;/diagram&gt;\n  &lt;diagram id=\&quot;yj-G8iHveYtJ76hmmKAs\&quot; name=\&quot;模型绘制路径\&quot;&gt;\n    &lt;mxGraphModel dx=\&quot;4778\&quot; dy=\&quot;-356\&quot; grid=\&quot;1\&quot; gridSize=\&quot;10\&quot; guides=\&quot;1\&quot; tooltips=\&quot;1\&quot; connect=\&quot;1\&quot; arrows=\&quot;1\&quot; fold=\&quot;1\&quot; page=\&quot;1\&quot; pageScale=\&quot;1\&quot; pageWidth=\&quot;827\&quot; pageHeight=\&quot;1169\&quot; math=\&quot;0\&quot; shadow=\&quot;0\&quot;&gt;\n      &lt;root&gt;\n        &lt;mxCell id=\&quot;0\&quot; /&gt;\n        &lt;mxCell id=\&quot;1\&quot; parent=\&quot;0\&quot; /&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-1\&quot; value=\&quot;FMeshBatchElement\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;861\&quot; y=\&quot;2352\&quot; width=\&quot;250\&quot; height=\&quot;250\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-2\&quot; value=\&quot;struct\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;250\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-3\&quot; value=\&quot;&amp;lt;div&amp;gt;储存了&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;：&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;网络的UniformBuffer和IndexBuffer在CPU侧的数据，若使用GPU Scene，FRHIUniformBuffer*会为nullptr。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;图元ID，包括GPU scene中的ID和动态图元自身ID。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Instance数量，Index范围。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;返回图元数量的函数：&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;int32 GetNumPrimitives() const;&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;250\&quot; height=\&quot;190\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-4\&quot; value=\&quot;\&quot; style=\&quot;verticalLabelPosition=bottom;verticalAlign=top;html=1;shape=mxgraph.basic.rect;fillColor2=none;strokeWidth=1;size=20;indent=5;fillColor=none;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-1\&quot;&gt;\n          &lt;mxGeometry y=\&quot;200\&quot; width=\&quot;250\&quot; height=\&quot;50\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-5\&quot; value=\&quot;FMeshBatch\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;1241\&quot; y=\&quot;2362\&quot; width=\&quot;310\&quot; height=\&quot;290\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-6\&quot; value=\&quot;struct\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-5\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;310\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-7\&quot; value=\&quot;储存了：&amp;lt;div&amp;gt;拥有相同材质和顶点缓冲的FMeshBatchElement的列表。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;与Element对应的定点工厂和材质。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;关于裁切，渲染pass和别的属性的标记。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;工具接口：&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;bool IsTranslucent(ERHIFeatureLevel::Type) const;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;bool IsDecal(&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;ERHIFeatureLevel::Type) const;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;bool IsDualBlend(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;ERHIFeatureLevel::Type) const;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;bool UseForHairStrands(&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;ERHIFeatureLevel::Type) const;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;bool IsMasked(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;ERHIFeatureLevel::Type) const;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;int32 GetNumPrimitives() const;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;bool HasAnyDrawCalls() const;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-5\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;310\&quot; height=\&quot;230\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-8\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.13;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-1\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-7\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-9\&quot; value=\&quot;FSceneRenderer::Render\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;851\&quot; y=\&quot;2622\&quot; width=\&quot;360\&quot; height=\&quot;240\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-10\&quot; value=\&quot;参数：FRHICommandListImmediate&amp;amp;amp; RHICmdList&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;场景渲染器在渲染之初会执行可见性剔除，期间会收集场景中所有FPrimitiveSceneProxy。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;bool FDederredShadingSceneRenderer::InitViews(RHICmdList,...&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;{&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;void FSceneRender::ComputeViewVisibility(RHICmdList,...)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;{&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;FSceneRender::GatherDynamicMeshElements(......);&amp;lt;br&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;遍历所有View，处理该View的FMeshPassProcessor。&amp;lt;br&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;SetupMeshPass(View, BasePassDepthStencilAccess, ViewCommands);&amp;lt;br&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;}&amp;lt;br&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;}&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-9\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;360\&quot; height=\&quot;210\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-11\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.75;entryDx=0;entryDy=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-12\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-10\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-12\&quot; value=\&quot;FSceneRender::GatherDynamicMeshElements\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;1261\&quot; y=\&quot;2702\&quot; width=\&quot;350\&quot; height=\&quot;317\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-13\&quot; value=\&quot;参数：会传入场景信息，视口信息，模型相关的全局动态缓冲，图元相关可见性掩码，还有一个网络收集器。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;先将InViews中的网络相关信息逐一添加至Collector中。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;遍历场景中所有图元，将可见的物体的信息添加至Collector，设置InViews中对应动态网络的index起点和末尾，期间会将动态网络数据添加至Collector，使用此方法：&amp;lt;br&amp;gt;PrimitiveSceneInfo-&amp;amp;gt;Proxy-&amp;amp;gt;GetDynamicMeshElements(InViewFamily.Views, InViewFamily, ViewMaskFinal, Collector);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;然后处理MeshPass的相关标记，将被View中对应MeshPass引用的MeshBatch添加到该MeshPass中，使用此方法：&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;ComputeDynamicMeshRelevance(ShadingPath, bAssLightmapDensityCommands, ViewRelevande, MeshBatch, View, PassRelevance, PrimitiveSceneInfo, Bounds);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;最后收集器执行任务。&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-12\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;350\&quot; height=\&quot;280\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-14\&quot; value=\&quot;FSkeletalMeshSceneProxy::GetDynamicMeshElements\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;851\&quot; y=\&quot;2872\&quot; width=\&quot;330\&quot; height=\&quot;127\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-15\&quot; value=\&quot;&amp;lt;div&amp;gt;由于基类FPrimitiveSceneProxy的GetDynamicMeshElements接口是空函数，使用子类Skeletal对应的Proxy实现为例：&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;包装：&amp;lt;div&amp;gt;GetMeshElementsCondiionallySelectable(Views, ViewFamily, True, VisibilityMap, Collector)&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-14\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;330\&quot; height=\&quot;100\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-16\&quot; value=\&quot;GetDynamicElementsSection\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;851\&quot; y=\&quot;3192\&quot; width=\&quot;240\&quot; height=\&quot;120\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-17\&quot; value=\&quot;在所有可见该物体的View中，从Colloctor中分配一个FMeshBatch，以此创建网络批次对象，并设置批次对象第一个的FMeshBatchElement对象实例。最后将FMeshBatch添加到Collector中。\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-16\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;240\&quot; height=\&quot;90\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-18\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.998;entryY=0.867;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-19\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-15\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint x=\&quot;1201\&quot; y=\&quot;3070\&quot; as=\&quot;targetPoint\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-19\&quot; value=\&quot;GetMeshElementsConditionallySelectable\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;851\&quot; y=\&quot;3032\&quot; width=\&quot;330\&quot; height=\&quot;120\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-20\&quot; value=\&quot;获得对应LOD，根据LOD便利所有的子模型，如果网络的材质和Section都可用，将对应LODIndex和ScetionIndex加入到Collector中，使用此方法：&amp;lt;br&amp;gt;GetDynamicElementsSection(Views, ..., LODData, LODIndex&amp;lt;div&amp;gt;, SectionIndex, ..., Collector&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;);&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-19\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;330\&quot; height=\&quot;90\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-21\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.007;entryY=0.543;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-15\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-13\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-22\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1.001;entryY=0.722;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-16\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-20\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-23\&quot; value=\&quot;ComputeDynamicMeshRelevance\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;941\&quot; y=\&quot;3332\&quot; width=\&quot;240\&quot; height=\&quot;160\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-24\&quot; value=\&quot;首先获得MeshPatch中的NumElements。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;在深度和主pass中，依次对其下的各个pass进行判断，若是通过了，则在对应pass的可见动态网络元素数量上再加NumElements。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;然后对半透明及其他pass做同样计数。&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-23\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;240\&quot; height=\&quot;130\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-25\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=-0.002;entryY=0.797;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-23\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-13\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-26\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.999;entryY=0.209;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-27\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-13\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint x=\&quot;1621.0000000000002\&quot; y=\&quot;2781.9999999999995\&quot; as=\&quot;targetPoint\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-27\&quot; value=\&quot;FMeshElementCollector\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;1271\&quot; y=\&quot;3087.0000000000005\&quot; width=\&quot;330\&quot; height=\&quot;370\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-28\&quot; value=\&quot;class\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-27\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;330\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-29\&quot; value=\&quot;FPrimitiveDrawInterface* GetPDI(int32 ViewIndex);&amp;lt;div&amp;gt;绘制点线面和sprite的接口。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;FMeshBatch&amp;amp;amp; AllocateMesh();&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;分配一个FMeshBatch对象。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;void AddMesh(int32 ViewIndex, FMeshBatch&amp;amp;amp; MeshBatch);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;添加MeshBatch到收集器中，会初始化再添加到列表中。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;还有很多获取类中变量数据的接口。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;还有移动/复制添加任务的接口。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Protected:&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;SetPrimitive(const FPrimitiveSceneProxy* Proxy, FHitProxyId DefualtId)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;设置FPrimitiveSceneProxy数据。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;void ClearViewMeshArrays();&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;void AddViewMeshArrays(InView, ......);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;清空和添加Mesh到View。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-27\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;330\&quot; height=\&quot;310\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-30\&quot; value=\&quot;FSceneRenderer::SetupMeshPass\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;510\&quot; y=\&quot;2362\&quot; width=\&quot;290\&quot; height=\&quot;160\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-31\&quot; value=\&quot;遍历EMeshPass枚举中的所有Pass。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;对每个Pass，创建FMeshPassProcessor，获取指定Pass的FParallelMeshDrawCommandPass对象，然后并行处理Pass的任务，创建所有绘制命令：&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Pass.DispatchPassSetup(Scene, View, PassType, BasePassDepthStencilAccess, MeshPassProcessor, View......., ViewCommands.......);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-30\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;290\&quot; height=\&quot;130\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-32\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=-0.008;entryY=0.074;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-33\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-31\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxPoint x=\&quot;496\&quot; y=\&quot;2698\&quot; as=\&quot;targetPoint\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-33\&quot; value=\&quot;EMeshPass\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;150\&quot; y=\&quot;2362.0000000000005\&quot; width=\&quot;250\&quot; height=\&quot;340\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-34\&quot; value=\&quot;enum\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-33\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;250\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-35\&quot; value=\&quot;DepthPass, 深度&amp;lt;div&amp;gt;BasePass, 几何/基础&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;SkyPass, 天空&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;SingleLayerWaterPass, 单层水体&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;CSMShadowDepth, 级联阴影深度&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Distortion, 扰动&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Velocity, 速度&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;透明相关Pass：&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;TransluicentVelocity,&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;TranslucencyStandard,&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;TranslucencyAfterDOF,&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;TranslucencyAfterDOFModulate,&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;TranslucencyAll,&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;编辑模式下的特殊Pass&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;HitProxy,&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;HitProxyOpaqueOnly,&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;EditorSelection,&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-33\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;250\&quot; height=\&quot;280\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-36\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.75;entryDx=0;entryDy=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-37\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-31\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-37\&quot; value=\&quot;FParallelMeshDrawXCommandPass::DispatchPassSetup\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;460\&quot; y=\&quot;2560\&quot; width=\&quot;350\&quot; height=\&quot;200\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-38\&quot; value=\&quot;首先计算出最大绘制数量MaxNumDraws。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;设置TaskContext数据，手机生成MeshCommand所需的数据。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;和传入的各种命令列表交换内存，将命令存入TaskContext的MeshDrawCommands，DynamicMeshCommandBuildRequests，若是移动端还有MobileBBasePassCSMMeshDrawCommand。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;根据MaxNumDraws在渲染线程分配资源。若是并行方式，便创建并行任务实例并加入TaskGraph。&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-37\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;350\&quot; height=\&quot;170\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-39\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.25;entryDx=0;entryDy=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-40\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-38\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-40\&quot; value=\&quot;FMeshDrawCommandPassSetupTaskContext\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;530\&quot; y=\&quot;2800\&quot; width=\&quot;280\&quot; height=\&quot;420\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-41\&quot; value=\&quot;class\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-40\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;280\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-42\&quot; value=\&quot;存有公开变量：&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;View相关数据：&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;View，ShadingPath，PassType等。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;网络通道处理器：&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;MeshPassProcessor，MobileBasePassSCMMeshPassProcessor，DynamicMeshElements，DynamicMeshElementsPassRelevance。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;命令相关数据：&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;InstanceFactor，MeshDrawCommands，MeshDrawCommandStorage等。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;需在渲染线程预分配的资源：&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;PrimitiveIdBufferData，PrimitiveIdBufferDataSize，TempVisibleMeshDrawCommands。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;透明物体排序所需：&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;TranslucencyPass，TranslucentSortAxis，PrimitiveBounds等。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;还有用于log的数据。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-40\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;280\&quot; height=\&quot;360\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-43\&quot; value=\&quot;FMeshDrawCommnadPassSetupTask\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;80\&quot; y=\&quot;2940\&quot; width=\&quot;420\&quot; height=\&quot;490\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-44\&quot; value=\&quot;class\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-43\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;420\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-45\&quot; value=\&quot;构造函数：&amp;lt;div&amp;gt;FMeshDrawCommandPassSetupTask(&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;FMeshDrawCommandPassSetupTaskContext&amp;amp;amp; InContext);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;用于将传入的context赋值到该类。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;void DoTask(ENamedThreads::Type CurrentThread, const FGraphEventRef&amp;amp;amp; MyCompletionGraphEvent)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;{AnyThreadTask();}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;void AnyThreadTask()&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;{&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;先判断所在的平台和支持的着色模型。&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;使用context中的数据生成动态和静态网络绘制指令：&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;GenerateDynamicMeshDrawCommands(context...);&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;使用context数据应用view中已存在的MeshDrawCommand：&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;ApplyViewOverridesToMeshDrawCommands(context...);&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;用context中view相关的数据更新网络排序键，包含BasePass和透明物体排序：&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;更新键值：&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;UpdateTranslucentMeshSortKeys(context...);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;执行绘制命令排序：&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;Context.MeshDrawCommands.Sort(FCompareFMeshDrawCommands());&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;如果是GPUScene，生成对应的Primitive数据：&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;BuildMeshDrawCommandPrimitiveIdBuffer(context...);&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;}&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;labelBackgroundColor=none;fontColor=default;fillColor=none;strokeColor=none;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-43\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;410\&quot; height=\&quot;430\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-46\&quot; value=\&quot;GenerateDynamicMeshDrawCommands\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;550\&quot; y=\&quot;3270\&quot; width=\&quot;240\&quot; height=\&quot;160\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-47\&quot; value=\&quot;构造FDynamicPassMeshDrawListContext实例，将其传递给PassMeshProcessor设置绘制命令上下文。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;然后将动态网络批次的FMeshBatch加入到PassMeshProcessor处理。再同样处理静态网络批次。&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-46\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;240\&quot; height=\&quot;130\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-48\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-46\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-45\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-49\&quot; value=\&quot;FMeshDrawCommandInitResourcesTask\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;20\&quot; y=\&quot;2720.0000000000005\&quot; width=\&quot;260\&quot; height=\&quot;190\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-50\&quot; value=\&quot;class\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-49\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;260\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-51\&quot; value=\&quot;和PassSetupTask同样，储存context变量。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;DoTask封装AnyThreadTask，Task初始化已绑定的所有shader资源：&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;遍历Context.MinimalPipelineStatePassSet中的Initializer，Initializer.BoundShaderState.LazilyInitShaders();&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-49\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;260\&quot; height=\&quot;130\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-52\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.841;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-43\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-38\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-53\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.9;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-49\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-38\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-54\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=-0.002;entryY=0.809;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-31\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-10\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-55\&quot; value=\&quot;FMeshDrawCommandSortKey\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;-270\&quot; y=\&quot;2800.0000000000005\&quot; width=\&quot;250\&quot; height=\&quot;270\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-56\&quot; value=\&quot;class\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-55\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;250\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-57\&quot; value=\&quot;FVisibleDrawCommandSortKey用来排序的键值。通过union分成了BasePass, Translucent, Generic, 比如BasePass可用于BasePassRendering, DepthRendering, MeshPassProcessor阶段；定义了!=和&amp;amp;lt;用于排序。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;union&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;{&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;uint64 PackedData;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;struct{...} BasePass;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;struct{...} Translucent;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;struct{...} Generic;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;};&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-55\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;250\&quot; height=\&quot;210\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-58\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.791;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-55\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-45\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-59\&quot; value=\&quot;FGraphicsMinimalPipelineStateInitializer\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;-270\&quot; y=\&quot;3100.0000000000005\&quot; width=\&quot;250\&quot; height=\&quot;360\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-60\&quot; value=\&quot;class\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-59\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;250\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-61\&quot; value=\&quot;AsGraphicsPipelineStateInitializer() const;&amp;lt;div&amp;gt;将自己的值拷贝一份出去。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;inline friend uint32 GetTypeHash(const FGraphicsMnimalPipelineStateInitializer&amp;amp;amp; Initializer);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;计算initializer的哈希值。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;比较接口：operator==, !=, &amp;amp;lt;, &amp;amp;gt;.&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;储存了渲染管线状态：&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;BoundShaderState, BlendState, RasterizerState, DepthStencilState, ImmutableSamplerState.&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;其他状态：&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;bDepthBounds, bMultiView, bHasFragmentDensityuAttachment.&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;EPrimitiveType PrimitiveType;&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-59\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;250\&quot; height=\&quot;300\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-62\&quot; value=\&quot;FGraphicsMinimalPipelineStateId\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;-810\&quot; y=\&quot;2362\&quot; width=\&quot;270\&quot; height=\&quot;380\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-63\&quot; value=\&quot;class\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-62\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;270\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-64\&quot; value=\&quot;&amp;lt;div&amp;gt;代表FGraphicsMinimalPipelineStateInitializer实例的唯一id，用于快排。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;uint32 GetId() const;&amp;lt;div&amp;gt;返回PackedId。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;inline const FG...Initializer&amp;amp;amp; GetPipelineState(cosnt FG...StateSet&amp;amp;amp; InPipelineSet) const;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;获取关联的initializer。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;永久pipeline state id相关：&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;InitializePersistentIds();&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;GetPersistentId(state);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;RemovePersistentId(id);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;RENDER_API FG...Id GetPipelineStateId(inpipelinestate, inoutpassset, needsshaderinitialisation);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;按如下顺序获取id，persist id表，passset参数，如果都没有则创建并加入到passset。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-62\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;270\&quot; height=\&quot;320\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-65\&quot; value=\&quot;FMeshDrawCommand\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;-480\&quot; y=\&quot;2362\&quot; width=\&quot;260\&quot; height=\&quot;418\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-66\&quot; value=\&quot;class\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-65\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;260\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-67\&quot; value=\&quot;网络绘制命令，储存绘制单个mesh所需的所有必要的资源和数据，该类不管理资源的生命周期。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;数据包括资源绑定，渲染管线状态，命令参数，顶点数据，等等。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;bool MatshesForDynamicInstancing(&amp;amp;amp;Rhs) const.&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;判断是否和指定command相匹配，若匹配则能合并绘制。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;uint32 GetDynamicInstancingHash() const;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;获取动态实例的哈希值。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;void SetDrawParametersAndFinalize(MeshBatch,...);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;将FMeshBatch的相关数据进行处理并传递到FMeshDrawCommand中。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;void Finalize(PipelineId, ShadersforDebug);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;保存id和shader调试信息。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;static void SubmitDraw(...);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;提交command到RHI commandlist。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-65\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;260\&quot; height=\&quot;360\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-68\&quot; value=\&quot;FVisibleMeshDrawCommand\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;-180\&quot; y=\&quot;2392.0000000000005\&quot; width=\&quot;250\&quot; height=\&quot;230\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-69\&quot; value=\&quot;class\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-68\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;250\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-70\&quot; value=\&quot;可见网络绘制命令，储存可见的网络的指令所需的信息，只储存InitViews操作，没有关于绘制提交的数据。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;const FMeshDrawCommand* MeshDrawCommand;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;关联的绘制指令实例。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;还有无状态排序建值SortKey，绘制图元id，场景图元id，图元id偏移，状态桶id。部分id能反向追踪FPrimitiveSceneInfo实例。&amp;lt;/div&amp;gt;\&quot; style=\&quot;whiteSpace=wrap;html=1;align=left;verticalAlign=top;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-68\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;250\&quot; height=\&quot;170\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-71\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.007;entryY=0.437;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-65\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-70\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-72\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.008;entryY=0.166;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-62\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-67\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-73\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.004;entryY=0.771;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-55\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-70\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-74\&quot; value=\&quot;FMeshPassProcessor\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;-820\&quot; y=\&quot;2819\&quot; width=\&quot;450\&quot; height=\&quot;641\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-75\&quot; value=\&quot;class\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-74\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;450\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-76\&quot; value=\&quot;网络通道处理器，不同meshpass通道对应的子类会继承该类并实现或重写虚函数。&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;构造函数会传入并给变量赋值：&amp;lt;br&amp;gt;Scene，FeatureLevel，ViewIfDynamicMeshCommand，DrawListContext。&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;增加FMeshBatch实例，由子类pass实现。&amp;lt;br&amp;gt;virtual void AddMeshBtach(MeshBatch, BatchElementMask, PrimitiveSceneProxy, StaticMeshId) = 0;&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;网络绘制策略重写设置&amp;lt;br&amp;gt;struct FMeshDrawinfPolocyOverrideSetting{&amp;lt;br&amp;gt;EDrawingPolicyOverrideFlags, EPrimitiveType;&amp;lt;br&amp;gt;}&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;将一个FMeshBatch转换成一个或多个MeshDrawCommands。&amp;lt;br&amp;gt;template&amp;amp;lt;typename PassShadersType, typename ShaderElementDataType&amp;amp;gt;&amp;lt;br&amp;gt;void BuildMeshDrawCommands(......)&amp;lt;br&amp;gt;{&amp;lt;br&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;网络绘制命令实例，用于收集渲染资源和数据。&amp;lt;br&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;FMeshDrawCommand SharedMeshDrawCommand;&amp;lt;br&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;br&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;处理绘制命令的模板数据。&amp;lt;br&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;SharedMeshDrawCommand.SetStencilRef(DrawRenderState.GetStencilRef());&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;渲染状态实例&amp;lt;br&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;FG..Mini..Initializer PipelineState;&amp;lt;br&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;然后将传入的数据复给它的PrimitiveType和ImmutavleSamplerState赋值。&amp;lt;br&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;br&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;处理命令的顶点数据，shader和渲染状态。&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;处理VS/PS/GS等shader的绑定数据，然后再遍历该MeshBatch的所有&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;BatchElment，从材质中获取与其关联的所有shader类型的绑定数据，绑定函数：（若是element的绑定，有部分变化，但过程一样）&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;FMeshDrawSingleSahderBindings ShaderBindings = S...Command.ShaderBingdings.GetSingleShaderBindings(sfvertex, dataoffset);&amp;lt;br&amp;gt;&amp;#x9;PassShaders.VertexShader-&amp;amp;gt;GetShaderBindings(.....,ShaderBindings);&amp;lt;br&amp;gt;}&amp;lt;/div&amp;gt;\&quot; style=\&quot;align=left;verticalAlign=top;html=1;whiteSpace=wrap;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-74\&quot;&gt;\n          &lt;mxGeometry y=\&quot;61\&quot; width=\&quot;450\&quot; height=\&quot;579\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-77\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1.002;entryY=0.648;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-59\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-76\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-78\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-67\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-76\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-79\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-80\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-75\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-80\&quot; value=\&quot;FBasePassMeshProcessor\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;-1200\&quot; y=\&quot;2388.0000000000005\&quot; width=\&quot;330\&quot; height=\&quot;731.9999999999995\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-81\&quot; value=\&quot;class : FMeshPassProcessor\&quot; style=\&quot;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-80\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;330\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-82\&quot; value=\&quot;基础pass网络处理器，会过滤与pass无关的网络批，选择绘制命令所需的shader和渲染状态，手机绘制命令涉及的shader资源绑定，收集drawcall相关参数。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;void AddMeshBatch(......)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;{&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;判断网络批是否使用材质。&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;如果是简单前向渲染：&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;AddMeshBatchForSimpleForwardShading(......);&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;或者是体积透明自阴影的物体：&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;Process&amp;amp;lt;FSelfShadowedVolumetricLightmapPolicy&amp;amp;gt;(......);&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;或者：&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;根据不同光照图配置，调用process进行处理：&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;Process&amp;amp;lt;FUniformLightmapPolicy&amp;amp;gt;(......);&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;processor对不同光照图类型进行处理，最后调用&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;BuildMeshDrawCommands将FMeshBatch转换成FMeshDrawCommands。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;template&amp;amp;lt;typename LightMapPolicyType&amp;amp;gt;(......)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;{&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;获取指定光照图策略的shader。&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;GetBasePassShaders&amp;amp;lt;LightMapPolicyType&amp;amp;gt;(......);&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;渲染状态处理。&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;FMeshPassProcessorRenderState DrawRenderState(PassDrawRenderState);&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;初始化材质数据。&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;TBasePassShaderElementData&amp;amp;lt;LightMapPolicyType&amp;amp;gt; ShaderElementData(LightMapElementData);&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;ShaderElementData.InitializeMeshMaterialData&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;(ViewIfDynamicMeshCommand, PrimitiveSceneProxy, MeshBatch, StaticMeshId, true);&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;处理排序建值。&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;FMeshDrawCommandSortKey SortKey = FMeshDrawCommandSortKey::Defualt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;根据是否透明进行不同方式的排序。&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;SortKey = Calculate...MeshStateSortKey(......);&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;将网络批的元素转换成绘制命令。&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;BuildMeshDrawCommands(......);&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;}&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-80\&quot;&gt;\n          &lt;mxGeometry y=\&quot;61.999999999999545\&quot; width=\&quot;330\&quot; height=\&quot;670\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-83\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.996;entryY=0.841;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-55\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-82\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-84\&quot; value=\&quot;FMeshPassDrawListContext\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;-1550\&quot; y=\&quot;2830\&quot; width=\&quot;270\&quot; height=\&quot;230\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-85\&quot; value=\&quot;网络通道绘制列表上下文基类。&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;virtual FMeshDrawCommand&amp;amp;amp; AddCommand(FMeshDrawCommand&amp;amp;amp; Initializer, uint32 NumElements) = 0;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;virtual void FinalizeCommand(BeshBatch, BatchElementIndex, DrawPrimitiveId, ScenePrimitiveId, MeshFillMode, MeshCullMode, SortKey, PipelineState, ShaderForDebugging, MeshDrawCommand) = 0;&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-84\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;270\&quot; height=\&quot;170\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-86\&quot; value=\&quot;class\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-84\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;270\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-87\&quot; value=\&quot;FDynamicPassMeshDrawListContext\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;-1585\&quot; y=\&quot;2388\&quot; width=\&quot;320\&quot; height=\&quot;400\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-88\&quot; value=\&quot;virtual FMeshDrawCommand&amp;amp;amp; AddCommand(......) override final&amp;lt;div&amp;gt;{&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;将网络绘制列表加进DrawListStorage列表，然后返回列表中该命令的地址。&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;virtual void FinalizeCommand(......) override final&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;{&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;获取渲染管线id，FGraphicMinimalPipelineStateId;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;将将网络批数据处理并保存到网络绘制命令：MeshDrawCommand.SetDrawParametersAndFinalize(......);&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;用网络绘制命令创建可见网络绘制命令，最后加入到绘制列表中，动态模式不进行合并和实例化绘制命令。&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;DrawList.Add(NewVisibleMeshDrawCommand);&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;私有变量：&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;保存网络绘制命令的列表DrawListStorage；可见网络数据命令列表，DrawList通过引用指向DrawListStorage的数据；管线状态数据集GraphicsMinimalPipelineStateSet。&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-87\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;320\&quot; height=\&quot;340\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-89\&quot; value=\&quot;class : FMeshPassDrawListContext\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-87\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;320\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-90\&quot; value=\&quot;FCachedPassMeshDrawListContext\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=30;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;\n          &lt;mxGeometry x=\&quot;-1545\&quot; y=\&quot;3120\&quot; width=\&quot;260\&quot; height=\&quot;360\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-91\&quot; value=\&quot;&amp;lt;div&amp;gt;缓存/静态网络通道绘制列表上下文。&amp;lt;/div&amp;gt;virtual FMeshDrawCommand&amp;amp;amp; AddCommand(......) override final&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;{&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;如果只有一个元素，直接返回传入的网络绘制命令Initializer；不然就将命令赋值给MeshDrawCommandForStateBucketing然后返回。&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;virtual void FinalizeCommand(......) override final&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;{&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;获取管线id，然后将数据保存到绘制命令。&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;如果是在GPUScene，计算哈希值并在CachedMeshDrawCommandStateBuckets中查找或添加并作对应计数增加，用于命令合并。&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;不然就在CommandInfo储存各种数据；将其放在lowest free index能让array更加有效率。&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;}&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-90\&quot;&gt;\n          &lt;mxGeometry y=\&quot;60\&quot; width=\&quot;260\&quot; height=\&quot;300\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-92\&quot; value=\&quot;class : FMeshPassDrawListContext\&quot; style=\&quot;rounded=0;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;LRTfeYOWw6Afg1dhsF7r-90\&quot;&gt;\n          &lt;mxGeometry y=\&quot;30\&quot; width=\&quot;260\&quot; height=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-93\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.003;entryY=0.968;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-84\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-82\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-94\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.109;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-88\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-84\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;LRTfeYOWw6Afg1dhsF7r-95\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=-0.002;entryY=0.111;entryDx=0;entryDy=0;entryPerimeter=0;\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;LRTfeYOWw6Afg1dhsF7r-90\&quot; target=\&quot;LRTfeYOWw6Afg1dhsF7r-84\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n      &lt;/root&gt;\n    &lt;/mxGraphModel&gt;\n  &lt;/diagram&gt;\n&lt;/mxfile&gt;\n&quot;}"></div>
<script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>
</body>
</html>